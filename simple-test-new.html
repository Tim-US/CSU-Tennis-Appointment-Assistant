<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘çƒåœºé¢„è®¢ç³»ç»Ÿ - æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            background-color: #2c5282;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .date-controls {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .date-btn {
            background-color: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .date-btn:hover {
            background-color: #3182ce;
        }
        
        .date-btn.active {
            background-color: #2b6cb0;
        }
        
        .court-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .court-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .court-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .time-slot {
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .time-slot.available {
            background-color: #c6f6d5;
            border-color: #48bb78;
            color: #22543d;
        }
        
        .time-slot.available:hover {
            background-color: #9ae6b4;
        }
        
        .time-slot.unavailable {
            background-color: #fed7d7;
            border-color: #e53e3e;
            color: #742a2a;
            cursor: not-allowed;
        }
        
        .time-slot.selected {
            background-color: #bee3f8;
            border-color: #3182ce;
            color: #2c5282;
        }
        
        .controls {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            background-color: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .control-btn:hover {
            background-color: #38a169;
        }
        
        .control-btn.danger {
            background-color: #e53e3e;
        }
        
        .control-btn.danger:hover {
            background-color: #c53030;
        }
        
        .log-container {
            background-color: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-timestamp {
            color: #718096;
        }
        
        .status-bar {
            background-color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-indicator.active {
            background-color: #c6f6d5;
            color: #22543d;
        }
        
        .status-indicator.inactive {
            background-color: #fed7d7;
            color: #742a2a;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¾ ç½‘çƒåœºé¢„è®¢ç³»ç»Ÿ</h1>
        <p>æ’ä»¶è°ƒè¯•æµ‹è¯•é¡µé¢ - æ”¯æŒæ—¥æœŸåˆ‡æ¢å’Œå¯é¢„çº¦çŠ¶æ€æ¨¡æ‹Ÿ</p>
    </div>
    
    <div class="status-bar">
        <div>
            <span>å½“å‰æ—¥æœŸ: </span>
            <span id="current-date">ä»Šå¤©</span>
        </div>
        <div>
            <span>ç›‘æ§çŠ¶æ€: </span>
            <span id="monitor-status" class="status-indicator inactive">æœªç›‘æ§</span>
        </div>
    </div>
    
    <div class="date-controls">
        <h3>ğŸ“… æ—¥æœŸé€‰æ‹©</h3>
        <button class="date-btn active" id="today-btn">ä»Šå¤©</button>
        <button class="date-btn" id="tomorrow-btn">åä¸€å¤©</button>
        <button class="date-btn" id="day-after-btn">åä¸¤å¤©</button>
    </div>
    
    <div class="controls">
        <h3>ğŸ”§ æµ‹è¯•æ§åˆ¶</h3>
        <button class="control-btn" id="add-available">æ·»åŠ å¯é¢„çº¦æ—¶æ®µ</button>
        <button class="control-btn" id="remove-available">ç§»é™¤å¯é¢„çº¦æ—¶æ®µ</button>
        <button class="control-btn" id="toggle-mix">åˆ‡æ¢æ··åˆçŠ¶æ€</button>
        <button class="control-btn danger" id="clear-all">æ¸…ç©ºæ‰€æœ‰æ—¶æ®µ</button>
        <button class="control-btn" id="simulate-real">æ¨¡æ‹ŸçœŸå®åœºæ™¯</button>
    </div>
    
    <div class="court-grid" id="court-grid">
        <!-- åœºåœ°å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <div class="controls">
        <h3>ğŸ“Š è°ƒè¯•æ—¥å¿—</h3>
        <button class="control-btn" id="clear-log">æ¸…ç©ºæ—¥å¿—</button>
        <button class="control-btn" id="export-log">å¯¼å‡ºæ—¥å¿—</button>
    </div>
    
    <div class="log-container" id="log-container">
        <div class="log-entry">
            <span class="log-timestamp">[åˆå§‹åŒ–]</span> æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…æ’ä»¶æ£€æµ‹...
        </div>
    </div>

    <script>
        class TestPage {
            constructor() {
                this.currentDate = 'today';
                this.courts = this.generateCourts();
                this.initializeEventListeners();
                this.renderCourts();
                this.startLogging();
                
                // æ¨¡æ‹Ÿæ’ä»¶å¯èƒ½æ£€æµ‹çš„é¡µé¢çŠ¶æ€
                this.pageStates = [
                    'normal', // æ­£å¸¸çŠ¶æ€
                    'available', // æœ‰å¯é¢„çº¦æ—¶æ®µ
                    'mixed', // æ··åˆçŠ¶æ€ï¼ˆæœ‰äº›å¯é¢„çº¦ï¼Œæœ‰äº›å·²é€‰æ‹©ï¼‰
                    'all-booked' // å…¨éƒ¨å·²é¢„è®¢
                ];
                this.currentState = 'normal';
                
                this.log('âœ… æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
                this.log('ğŸ“… å½“å‰æ˜¾ç¤º: ' + this.currentDate);
            }
            
            generateCourts() {
                const courts = [];
                const courtNames = ['1å·åœºåœ°', '2å·åœºåœ°', '3å·åœºåœ°', '4å·åœºåœ°'];
                const timeSlots = [
                    '08:00-09:00', '09:00-10:00', '10:00-11:00', '11:00-12:00',
                    '14:00-15:00', '15:00-16:00', '16:00-17:00', '17:00-18:00',
                    '18:00-19:00', '19:00-20:00', '20:00-21:00', '21:00-22:00'
                ];
                
                courtNames.forEach(courtName => {
                    const court = {
                        name: courtName,
                        slots: timeSlots.map(time => ({
                            time: time,
                            status: 'unavailable', // 'available', 'unavailable', 'selected'
                            id: `${courtName}-${time}`
                        }))
                    };
                    courts.push(court);
                });
                
                return courts;
            }
            
            initializeEventListeners() {
                // æ—¥æœŸåˆ‡æ¢æŒ‰é’®
                document.getElementById('today-btn').addEventListener('click', () => this.switchDate('today'));
                document.getElementById('tomorrow-btn').addEventListener('click', () => this.switchDate('tomorrow'));
                document.getElementById('day-after-btn').addEventListener('click', () => this.switchDate('day-after'));
                
                // æ§åˆ¶æŒ‰é’®
                document.getElementById('add-available').addEventListener('click', () => this.addAvailableSlots());
                document.getElementById('remove-available').addEventListener('click', () => this.removeAvailableSlots());
                document.getElementById('toggle-mix').addEventListener('click', () => this.toggleMixedState());
                document.getElementById('clear-all').addEventListener('click', () => this.clearAllSlots());
                document.getElementById('simulate-real').addEventListener('click', () => this.simulateRealScenario());
                
                // æ—¥å¿—æ§åˆ¶
                document.getElementById('clear-log').addEventListener('click', () => this.clearLog());
                document.getElementById('export-log').addEventListener('click', () => this.exportLog());
            }
            
            switchDate(date) {
                this.currentDate = date;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.date-btn').forEach(btn => btn.classList.remove('active'));
                if (date === 'today') {
                    document.getElementById('today-btn').classList.add('active');
                    document.getElementById('current-date').textContent = 'ä»Šå¤©';
                } else if (date === 'tomorrow') {
                    document.getElementById('tomorrow-btn').classList.add('active');
                    document.getElementById('current-date').textContent = 'æ˜å¤©';
                } else if (date === 'day-after') {
                    document.getElementById('day-after-btn').classList.add('active');
                    document.getElementById('current-date').textContent = 'åå¤©';
                }
                
                this.log(`ğŸ“… åˆ‡æ¢åˆ°: ${date} (${document.getElementById('current-date').textContent})`);
                
                // é‡ç½®åœºåœ°çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿä¸åŒæ—¥æœŸçš„ä¸åŒçŠ¶æ€ï¼‰
                this.resetCourtsForDate(date);
                this.renderCourts();
            }
            
            resetCourtsForDate(date) {
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        slot.status = 'unavailable'; // é»˜è®¤éƒ½ä¸å¯é¢„çº¦
                    });
                });
                
                // æ ¹æ®æ—¥æœŸæ¨¡æ‹Ÿä¸åŒçš„å¯é¢„çº¦æƒ…å†µ
                if (date === 'tomorrow') {
                    // æ˜å¤©æœ‰æ›´å¤šå¯é¢„çº¦æ—¶æ®µ
                    this.addRandomAvailableSlots(8);
                } else if (date === 'today') {
                    // ä»Šå¤©åªæœ‰å°‘é‡å¯é¢„çº¦æ—¶æ®µ
                    this.addRandomAvailableSlots(3);
                } else {
                    // åå¤©æœ‰ä¸­ç­‰æ•°é‡å¯é¢„çº¦æ—¶æ®µ
                    this.addRandomAvailableSlots(5);
                }
            }
            
            addRandomAvailableSlots(count) {
                const allSlots = [];
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        allSlots.push(slot);
                    });
                });
                
                // éšæœºé€‰æ‹©ä¸€äº›æ—¶æ®µè®¾ä¸ºå¯é¢„çº¦
                for (let i = 0; i < count && i < allSlots.length; i++) {
                    const randomIndex = Math.floor(Math.random() * allSlots.length);
                    allSlots[randomIndex].status = 'available';
                }
            }
            
            addAvailableSlots() {
                let addedCount = 0;
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        if (slot.status === 'unavailable' && Math.random() < 0.3) {
                            slot.status = 'available';
                            addedCount++;
                        }
                    });
                });
                
                this.log(`â• æ·»åŠ äº† ${addedCount} ä¸ªå¯é¢„çº¦æ—¶æ®µ`);
                this.renderCourts();
            }
            
            removeAvailableSlots() {
                let removedCount = 0;
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        if (slot.status === 'available') {
                            slot.status = 'unavailable';
                            removedCount++;
                        }
                    });
                });
                
                this.log(`â– ç§»é™¤äº† ${removedCount} ä¸ªå¯é¢„çº¦æ—¶æ®µ`);
                this.renderCourts();
            }
            
            toggleMixedState() {
                let changedCount = 0;
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        if (slot.status === 'available' && Math.random() < 0.4) {
                            slot.status = 'selected';
                            changedCount++;
                        } else if (slot.status === 'selected') {
                            slot.status = 'available';
                            changedCount++;
                        }
                    });
                });
                
                this.log(`ğŸ”„ åˆ‡æ¢äº† ${changedCount} ä¸ªæ—¶æ®µçš„çŠ¶æ€ï¼ˆå¯é¢„çº¦âŸ·å·²é€‰æ‹©ï¼‰`);
                this.renderCourts();
            }
            
            clearAllSlots() {
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        slot.status = 'unavailable';
                    });
                });
                
                this.log('ğŸ—‘ï¸ æ¸…ç©ºäº†æ‰€æœ‰æ—¶æ®µçŠ¶æ€');
                this.renderCourts();
            }
            
            simulateRealScenario() {
                // æ¨¡æ‹ŸçœŸå®çš„é¢„çº¦åœºæ™¯
                this.clearAllSlots();
                
                // æ·»åŠ ä¸€äº›å¯é¢„çº¦æ—¶æ®µ
                const scenarios = [
                    { description: 'æ—©æ™¨æœ‰å°‘é‡ç©ºæ¡£', slots: 2, timePattern: /^0[89]/ },
                    { description: 'ä¸‹åˆé«˜å³°æœŸæœ‰ç©ºæ¡£', slots: 3, timePattern: /^1[456]/ },
                    { description: 'æ™šä¸Šé»„é‡‘æ—¶æ®µæœ‰ç©ºæ¡£', slots: 4, timePattern: /^(18|19|20)/ },
                    { description: 'å…¨å¤©åˆ†æ•£ç©ºæ¡£', slots: 6, timePattern: null }
                ];
                
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                this.log(`ğŸ¬ æ¨¡æ‹Ÿåœºæ™¯: ${scenario.description}`);
                
                let addedCount = 0;
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        if (addedCount < scenario.slots) {
                            if (!scenario.timePattern || scenario.timePattern.test(slot.time)) {
                                if (Math.random() < 0.6) {
                                    slot.status = 'available';
                                    addedCount++;
                                }
                            }
                        }
                    });
                });
                
                // éšæœºæ·»åŠ ä¸€äº›å·²é€‰æ‹©çš„æ—¶æ®µï¼ˆæ¨¡æ‹Ÿå…¶ä»–ç”¨æˆ·æ­£åœ¨é¢„çº¦ï¼‰
                let selectedCount = 0;
                this.courts.forEach(court => {
                    court.slots.forEach(slot => {
                        if (slot.status === 'unavailable' && selectedCount < 2 && Math.random() < 0.1) {
                            slot.status = 'selected';
                            selectedCount++;
                        }
                    });
                });
                
                this.log(`âœ¨ åœºæ™¯è®¾ç½®å®Œæˆ: ${addedCount} ä¸ªå¯é¢„çº¦ï¼Œ${selectedCount} ä¸ªå·²é€‰æ‹©`);
                this.renderCourts();
            }
            
            renderCourts() {
                const courtGrid = document.getElementById('court-grid');
                courtGrid.innerHTML = '';
                
                let totalAvailable = 0;
                let totalSelected = 0;
                
                this.courts.forEach(court => {
                    const courtCard = document.createElement('div');
                    courtCard.className = 'court-card';
                    
                    const courtTitle = document.createElement('div');
                    courtTitle.className = 'court-title';
                    courtTitle.textContent = court.name;
                    courtCard.appendChild(courtTitle);
                    
                    const timeSlots = document.createElement('div');
                    timeSlots.className = 'time-slots';
                    
                    court.slots.forEach(slot => {
                        const slotElement = document.createElement('div');
                        slotElement.className = `time-slot ${slot.status}`;
                        slotElement.textContent = slot.time;
                        
                        if (slot.status === 'available') {
                            slotElement.textContent += ' å¯é¢„çº¦';
                            totalAvailable++;
                        } else if (slot.status === 'selected') {
                            slotElement.textContent += ' å·²é€‰æ‹©';
                            totalSelected++;
                        }
                        
                        slotElement.addEventListener('click', () => {
                            this.toggleSlotStatus(slot);
                            this.renderCourts();
                        });
                        
                        timeSlots.appendChild(slotElement);
                    });
                    
                    courtCard.appendChild(timeSlots);
                    courtGrid.appendChild(courtCard);
                });
                
                // æ›´æ–°ç›‘æ§çŠ¶æ€æ˜¾ç¤º
                const statusElement = document.getElementById('monitor-status');
                if (totalAvailable > 0) {
                    statusElement.textContent = `å‘ç° ${totalAvailable} ä¸ªå¯é¢„çº¦æ—¶æ®µ`;
                    statusElement.className = 'status-indicator active';
                } else {
                    statusElement.textContent = 'æ— å¯é¢„çº¦æ—¶æ®µ';
                    statusElement.className = 'status-indicator inactive';
                }
                
                this.log(`ğŸ“Š é¡µé¢æ›´æ–°: ${totalAvailable} ä¸ªå¯é¢„çº¦ï¼Œ${totalSelected} ä¸ªå·²é€‰æ‹©`);
            }
            
            toggleSlotStatus(slot) {
                const statusOrder = ['unavailable', 'available', 'selected'];
                const currentIndex = statusOrder.indexOf(slot.status);
                const nextIndex = (currentIndex + 1) % statusOrder.length;
                slot.status = statusOrder[nextIndex];
                
                this.log(`ğŸ–±ï¸ æ‰‹åŠ¨åˆ‡æ¢ ${slot.id}: ${slot.status}`);
            }
            
            log(message) {
                const logContainer = document.getElementById('log-container');
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                const timestamp = new Date().toLocaleTimeString();
                logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> ${message}`;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                // æ§åˆ¶å°ä¹Ÿè¾“å‡ºï¼Œæ–¹ä¾¿æ’ä»¶è°ƒè¯•
                console.log(`[æµ‹è¯•é¡µé¢] ${message}`);
            }
            
            clearLog() {
                document.getElementById('log-container').innerHTML = '';
                this.log('ğŸ—‘ï¸ æ—¥å¿—å·²æ¸…ç©º');
            }
            
            exportLog() {
                const logEntries = document.querySelectorAll('.log-entry');
                let logText = '';
                logEntries.forEach(entry => {
                    logText += entry.textContent + '\n';
                });
                
                const blob = new Blob([logText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tennis-plugin-test-log-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.log('ğŸ“ æ—¥å¿—å·²å¯¼å‡º');
            }
            
            startLogging() {
                // å®šæœŸè¾“å‡ºé¡µé¢çŠ¶æ€ï¼Œå¸®åŠ©æ’ä»¶è°ƒè¯•
                setInterval(() => {
                    const availableCount = this.courts.reduce((total, court) => {
                        return total + court.slots.filter(slot => slot.status === 'available').length;
                    }, 0);
                    
                    if (availableCount > 0) {
                        this.log(`ğŸ” å®šæœŸæ£€æŸ¥: å½“å‰æœ‰ ${availableCount} ä¸ªå¯é¢„çº¦æ—¶æ®µ`);
                    }
                }, 30000); // æ¯30ç§’è¾“å‡ºä¸€æ¬¡çŠ¶æ€
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.testPage = new TestPage();
        });
        
        // ä¸ºæ’ä»¶æä¾›çš„è°ƒè¯•æ¥å£
        window.getTestPageStatus = function() {
            return {
                currentDate: window.testPage?.currentDate || 'unknown',
                availableSlots: window.testPage?.courts?.reduce((total, court) => {
                    return total + court.slots.filter(slot => slot.status === 'available').length;
                }, 0) || 0,
                totalSlots: window.testPage?.courts?.reduce((total, court) => {
                    return total + court.slots.length;
                }, 0) || 0
            };
        };
    </script>
</body>
</html>
