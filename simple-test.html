<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘çƒåœºé¢„çº¦ç›‘æ§æµ‹è¯• - ä¸­å—å¤§å­¦åœºé¦†é¢„çº¦</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .status-tips {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .venue-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .venue-table th, .venue-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            font-size: 14px;
        }
        
        .venue-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        
        .available {
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
        }
        
        .unavailable {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .btn-success {
            background-color: #28a745;
        }
        
        .debug-info {
            background: #f1f3f4;
            border-left: 4px solid #4285f4;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        #log-container {
            background-color: #333;
            color: #f0f0f0;
            font-family: 'Courier New', monospace;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            height: 300px;
            overflow-y: scroll;
            font-size: 13px;
            line-height: 1.5;
        }

        #log-container .log-entry {
            padding: 2px 0;
            border-bottom: 1px solid #444;
        }

        #log-container .log-time {
            color: #888;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¾ ç½‘çƒåœºé¢„çº¦ç›‘æ§æµ‹è¯•</h1>
        <p>æµ‹è¯•ç›‘æ§æ’ä»¶çš„å‡†ç¡®æ€§å’Œæ€§èƒ½</p>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š ç›‘æ§æµ‹è¯•è¯´æ˜</h2>
        <div class="status-tips">
            ğŸ’¡ <strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong><br>
            1. æ‰“å¼€Chromeæ‰©å±•çš„popupç•Œé¢<br>
            2. ç‚¹å‡»"å¼€å§‹ç›‘æ§"æŒ‰é’®<br>
            3. åˆ·æ–°æ­¤é¡µé¢æµ‹è¯•è‡ªåŠ¨ç›‘æ§<br>
            4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°(F12)çš„è¯¦ç»†æ—¥å¿—
        </div>
        <div class="debug-info" id="debugInfo">
            è°ƒè¯•ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...<br>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ åŠ¨æ€æµ‹è¯•æ§åˆ¶</h2>
        <button class="btn btn-success" onclick="addAvailableSlots()">æ·»åŠ å¯é¢„çº¦æ—¶æ®µ</button>
        <button class="btn" onclick="removeAvailableSlots()">ç§»é™¤å¯é¢„çº¦æ—¶æ®µ</button>
        <button class="btn" onclick="simulateLoading()">æ¨¡æ‹Ÿé¡µé¢åŠ è½½</button>
        <button class="btn" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h2>ğŸ† ç½‘çƒåœºé¢„çº¦è¡¨</h2>
        <table class="venue-table" id="venueTable">
            <thead>
                <tr>
                    <th>æ—¶é—´</th>
                    <th>1å·åœºåœ°</th>
                    <th>2å·åœºåœ°</th>
                    <th>3å·åœºåœ°</th>
                    <th>4å·åœºåœ°</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>08:00-09:00</td>
                    <td class="unavailable">å·²é¢„çº¦</td>
                    <td class="available">å¯é¢„çº¦ ï¿¥40å…ƒ</td>
                    <td class="unavailable">ä¸å¯é¢„çº¦</td>
                    <td class="available">å¯é¢„çº¦ ï¿¥40å…ƒ</td>
                </tr>
                <tr>
                    <td>09:00-10:00</td>
                    <td class="available">å¯é¢„çº¦ ï¿¥40å…ƒ</td>
                    <td class="unavailable">å·²é¢„çº¦</td>
                    <td class="available">å¯é¢„çº¦ ï¿¥40å…ƒ</td>
                    <td class="unavailable">é¢„çº¦æ»¡</td>
                </tr>
                <tr>
                    <td>14:00-15:00</td>
                    <td class="available">å¯é¢„çº¦ ï¿¥35å…ƒ</td>
                    <td class="available">å¯é¢„çº¦ ï¿¥35å…ƒ</td>
                    <td class="unavailable">ä¸å¯é¢„çº¦</td>
                    <td class="available">å¯é¢„çº¦ ï¿¥35å…ƒ</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>å®æ—¶æ—¥å¿— (æ¥è‡ªæ’ä»¶å†…å®¹è„šæœ¬)</h2>
        <div id="log-container"></div>
    </div>

    <div class="debug-info">
        <p><strong>è°ƒè¯•ä¿¡æ¯:</strong></p>
        <p>æ­¤é¡µé¢ç”¨äºéªŒè¯æ’ä»¶èƒ½å¦æ­£ç¡®è¯†åˆ«â€œå¯é¢„çº¦â€çŠ¶æ€å¹¶è§¦å‘é€šçŸ¥ï¼ŒåŒæ—¶å¿½ç•¥â€œå·²é¢„çº¦â€ã€â€œå·²é€‰æ‹©â€ç­‰å¹²æ‰°é¡¹ã€‚</p>
    </div>

    <script>
        const scheduleContainer = document.getElementById('schedule-container');
        const logContainer = document.getElementById('log-container');
        const venueTable = document.getElementById('venueTable');
        const debugInfo = document.getElementById('debugInfo');

        // é‡å†™ console.log ä»¥ä¾¿åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæ—¥å¿—
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const timeSpan = document.createElement('span');
            timeSpan.className = 'log-time';
            timeSpan.textContent = new Date().toLocaleTimeString();
            logEntry.appendChild(timeSpan);

            const message = args.map(arg => {
                if (typeof arg === 'object' && arg !== null) {
                    try {
                        return JSON.stringify(arg, null, 2);
                    } catch (e) {
                        return '[Circular Object]';
                    }
                } else {
                    return String(arg);
                }
            }).join(' ');
            logEntry.appendChild(document.createTextNode(message));
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.style.color = '#ff6b6b';
            logEntry.innerHTML = `<span class="log-time">${new Date().toLocaleTimeString()}</span> âŒ ${args.join(' ')}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        function clearLogs() {
            logContainer.innerHTML = '';
        }

        // æ·»åŠ å¯é¢„çº¦æ—¶æ®µ
        function addAvailableSlots() {
            console.log('ğŸ”„ æ·»åŠ å¯é¢„çº¦æ—¶æ®µ');
            const rows = venueTable.querySelectorAll('tbody tr');
            // éšæœºé€‰æ‹©1-3ä¸ªå•å…ƒæ ¼æ”¹ä¸º"å¯é¢„çº¦"
            let changed = 0;
            for (let i = 0; i < rows.length && changed < 3; i++) {
                const cells = rows[i].querySelectorAll('td:not(:first-child)');
                for (let j = 0; j < cells.length && changed < 3; j++) {
                    if (Math.random() < 0.3 && !cells[j].classList.contains('available')) {
                        cells[j].textContent = 'å¯é¢„çº¦ ï¿¥' + (Math.floor(Math.random() * 20) + 30) + 'å…ƒ';
                        cells[j].className = 'available';
                        changed++;
                    }
                }
            }
            debugInfo.innerHTML = `å·²æ·»åŠ  ${changed} ä¸ªå¯é¢„çº¦æ—¶æ®µï¼Œå½“å‰å…±æœ‰ ${document.querySelectorAll('td.available').length} ä¸ªå¯é¢„çº¦æ—¶æ®µ`;
            console.log(`âœ… å·²æ·»åŠ  ${changed} ä¸ªå¯é¢„çº¦æ—¶æ®µï¼Œå½“å‰å…±æœ‰ ${document.querySelectorAll('td.available').length} ä¸ªå¯é¢„çº¦æ—¶æ®µ`);
        }

        // ç§»é™¤å¯é¢„çº¦æ—¶æ®µ
        function removeAvailableSlots() {
            console.log('ğŸ”„ ç§»é™¤å¯é¢„çº¦æ—¶æ®µ');
            const availableCells = document.querySelectorAll('td.available');
            let changed = 0;
            availableCells.forEach(cell => {
                if (Math.random() < 0.7) {
                    const states = ['å·²é¢„çº¦', 'ä¸å¯é¢„çº¦', 'é¢„çº¦æ»¡', 'å·²æ»¡'];
                    cell.textContent = states[Math.floor(Math.random() * states.length)];
                    cell.className = 'unavailable';
                    changed++;
                }
            });
            debugInfo.innerHTML = `å·²ç§»é™¤ ${changed} ä¸ªå¯é¢„çº¦æ—¶æ®µï¼Œå½“å‰å‰©ä½™ ${document.querySelectorAll('td.available').length} ä¸ªå¯é¢„çº¦æ—¶æ®µ`;
            console.log(`âœ… å·²ç§»é™¤ ${changed} ä¸ªå¯é¢„çº¦æ—¶æ®µï¼Œå½“å‰å‰©ä½™ ${document.querySelectorAll('td.available').length} ä¸ªå¯é¢„çº¦æ—¶æ®µ`);
        }

        // æ¨¡æ‹Ÿé¡µé¢åŠ è½½çŠ¶æ€
        function simulateLoading() {
            console.log('ğŸ”„ æ¨¡æ‹Ÿé¡µé¢åŠ è½½ä¸­...');
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = '9999';
            overlay.innerHTML = '<div style="text-align:center"><div style="width:50px;height:50px;border:5px solid #f3f3f3;border-top:5px solid #3498db;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto;"></div><p style="margin-top:10px">é¡µé¢åŠ è½½ä¸­...</p></div>';
            document.body.appendChild(overlay);

            // æ·»åŠ åŠ¨ç”»æ ·å¼
            const style = document.createElement('style');
            style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
            document.head.appendChild(style);

            setTimeout(() => {
                overlay.remove();
                console.log('âœ… é¡µé¢åŠ è½½å®Œæˆ');
                debugInfo.innerHTML = 'é¡µé¢åŠ è½½æ¨¡æ‹Ÿå®Œæˆ';
            }, 3000);
        }

        function createSchedule(data) {
            const table = document.createElement('table');
            table.className = 'venue-table';
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');
            
            // è¡¨å¤´
            const headerRow = document.createElement('tr');
            Object.keys(data[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key === 'time' ? 'æ—¶é—´' : `${key}å·åœºåœ°`;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            // è¡¨èº«
            data.forEach(rowData => {
                const row = document.createElement('tr');
                Object.values(rowData).forEach(cellData => {
                    const td = document.createElement('td');
                    td.textContent = cellData;
                    row.appendChild(td);
                });
                tbody.appendChild(row);
            });
            table.appendChild(thead);
            table.appendChild(tbody);
            
            scheduleContainer.innerHTML = '';
            scheduleContainer.appendChild(table);
        }

        function showAvailable() {
            console.log('--- åœºæ™¯åˆ‡æ¢: æ¨¡æ‹Ÿâ€œå¯é¢„çº¦â€å‡ºç° ---');
            const data = [
                { time: '14:00-15:00', court1: 'å·²é¢„çº¦', court2: 'å¯é¢„çº¦', court3: 'ä¸å¯é¢„çº¦' },
                { time: '15:00-16:00', court1: 'å¯é¢„çº¦', court2: 'å¯é¢„çº¦', court3: 'å·²é¢„çº¦' },
                { time: '16:00-17:00', court1: 'ä¸å¯é¢„çº¦', court2: 'å·²é¢„çº¦', court3: 'å¯é¢„çº¦' }
            ];
            createSchedule(data);
        }

        function showMixed() {
            console.log('--- åœºæ™¯åˆ‡æ¢: æ¨¡æ‹Ÿâ€œæ··åˆçŠ¶æ€â€ ---');
            const data = [
                { time: '18:00-19:00', court1: 'å·²é€‰æ‹©', court2: 'å¯é¢„çº¦ (å­¦ç”Ÿä¸ªäººé¢„çº¦)', court3: 'å·²é¢„çº¦' },
                { time: '19:00-20:00', court1: 'å·²é¢„çº¦', court2: 'å·²æ»¡', court3: 'å¯é¢„çº¦' },
                { time: '20:00-21:00', court1: 'ä¸å¯é¢„çº¦', court2: 'å·²é¢„çº¦', court3: 'å·²é€‰æ‹©' }
            ];
            createSchedule(data);
        }

        function showUnavailable() {
            console.log('--- åœºæ™¯åˆ‡æ¢: æ¨¡æ‹Ÿâ€œå…¨éƒ¨ä¸å¯é¢„çº¦â€ ---');
            const data = [
                { time: '09:00-10:00', court1: 'å·²é¢„çº¦', court2: 'å·²æ»¡', court3: 'ä¸å¯é¢„çº¦' },
                { time: '10:00-11:00', court1: 'ä¸å¯é¢„çº¦', court2: 'å·²é¢„çº¦', court3: 'å·²é¢„çº¦' },
                { time: '11:00-12:00', court1: 'å·²æ»¡', court2: 'å·²æ»¡', court3: 'å·²æ»¡' }
            ];
            createSchedule(data);
        }

        function showPopup() {
            console.log('--- åœºæ™¯åˆ‡æ¢: æ¨¡æ‹Ÿâ€œå¼¹çª—å‡ºç°â€ ---');
            const popup = document.createElement('div');
            popup.style.position = 'fixed';
            popup.style.left = '50%';
            popup.style.top = '50%';
            popup.style.transform = 'translate(-50%, -50%)';
            popup.style.backgroundColor = 'white';
            popup.style.padding = '30px';
            popup.style.border = '1px solid #ccc';
            popup.style.boxShadow = '0 5px 15px rgba(0,0,0,0.3)';
            popup.style.zIndex = '1000';
            popup.className = 'layui-layer'; // æ¨¡æ‹Ÿä¸€ä¸ªå¸¸è§çš„å¼¹çª—ç±»å
            popup.innerHTML = `
                <h3>æ¸©é¦¨æç¤º</h3>
                <p>è¯·å…ˆç™»å½•åå†è¿›è¡Œæ“ä½œã€‚</p>
                <button class="btn btn-success" onclick="this.parentElement.remove()">å¥½çš„</button>
            `;
            document.body.appendChild(popup);
        }

        // åˆå§‹çŠ¶æ€
        showUnavailable();
    </script>
</body>
</html>
